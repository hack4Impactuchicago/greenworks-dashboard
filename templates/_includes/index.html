{% import 'chartTemplate.html' as charts %}

<div class= "row">
  <div class="medium-16 column">
		<h2>About</h2>
			<p>The Greenworks Dashboard is a joint project between the City of Philadelphia's
				<a href="https://beta.phila.gov/departments/office-of-sustainability/programs/greenworks/">
					Office of Sustainability
				</a> and
				<a href="https://beta.phila.gov/departments/office-of-the-chief-administrative-officer/functions/office-of-open-data-and-digital-transformation/">
					Office of Open Data and Digital Transformation
				</a>.
			</p>
			<p>This dashboard provides easy-to-use responsive visualization tools for viewing data about the eight sustainability visions set in <a href="https://beta.phila.gov/documents/greenworks-a-vision-for-a-sustainable-philadelphia/">Greenworks: A Vision for a Sustainable Philadelphia</a>.</p>
			<p><b>Note:</b> This data will be updated as available on an ongoing basis.</p>
		<h3>How to use</h3>
			<p>Click the color blocks in any chart legend to add or remove that data from the chart.</p>
	</div>
	<div class="medium-8 column">
	  <aside id="secondary" class="related pll-mu">
	    <p>This is an open source project that uses the City of Philadelphia <a href="https://github.com/CityOfPhiladelphia/patterns">patterns</a>, <a href="http://jekyllrb.com/">Jekyll</a>, and <a href="http://www.chartjs.org/">Chart.js</a>. </p>
      <a href="http://beta.phila.gov/feedback" class="button icon">Leave Feedback<i class="fa fa-comment"></i></a>
	    <br>
	    <a href="https://github.com/CityOfPhiladelphia/greenworks-dashboard" class="button icon">Source Code<i class="fa fa-code"></i></a>
	    <br>
	    <a href="https://www.opendataphilly.org/dataset/greenworks-dashboard" class="button icon">Download Data<i class="fa fa-table"></i></a>
      <br>
      {% if session['authenticated'] == True %}
      <a id="popupbutton" class="button icon">
          Upload Data
          <i class="fa fa-cloud-upload"></i>
      </a>
      {% endif %}
	  </aside>
	</div>
</div>

{% if session['authenticated'] == True %}

<div id="myModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <div class="form-container">
        <h2 class="formHeader">Greenworks Dashboard: Upload Data</h2>
				<h4 class="formHeader">**Note: Upload permitted for specific individuals only!</h4>
          <form id="CSVForm" action={{ url_for('upload') }} method="post" class="inner-form-container" enctype = "multipart/form-data">
							<div class="input-div formItems">
								<input type="file" name="Upload" id="fileUpload" accept=".csv" class="inputfile inputfile-1"/>
								<label for="fileUpload"><span>Choose a CSV file!</span></label>
							</div>
							<div class="graphtypes formItems">
									<label for="graph_type" class="graph_type">Graph Type</label>
									<select name="graphtypes_">
  									<option value="bar">Bar Graph</option>
  									<option value="line">Line Graph</option>
										<option value="scatter">Scatter Plot</option>
									</select>
              </div>
							<div class="graphtypes formItems">
									<label for="vision">Vision Title</label>
                  <input type="text" id="vision" name="vision" />
              </div>
              <div class="graphtypes formItems">
									<label for="title">Title</label>
                  <input type="text" id="title" name="title" />
              </div>
              <div class="graphtypes formItems">
									<label>Axis Titles</label>
									<div class="atitles">
										<span class="alines">Dependent:</span><input type="text" id="axis-title-1" class="axisTitle" name="title-x" /><label for="axis-title-1"></label><br/>
                  	<span class="alines">Independent:</span><input type="text" id="axis-title-2" class="axisTitle" name="title-y" /><label for="axis-title-2"></label><br/>
									</div>
							</div>
							<div class="graphtypes formItems">
              		<label for="purpose">Purpose Statement</label>
                  <textarea id="purpose" name="purpose" style="height:100px"></textarea>
              </div>
							<div class="graphtypes formItems">
              		<label for="description">Description</label>
                  <textarea id="description" name="subject" style="height:200px"></textarea>
              </div>
						<div class="formItems">
	            <h3 class="titlesColorChoosers">Background and Border Color</h3>
							<div class="graphtypes-2">
								<input type="checkbox" id="DefaultBBC" name="BBCcheck"/>
								<label for="DefaultBBC"  class="default dbbc">iff  check if you want default colors set.</label>
							</div>
							<section class="radioBBcwrap">
								<div>
								  <input type="radio" id="control_01" name="selectBBC" value="1" class="menuoptBBC">
								  <label for="control_01" class="radioBBC bbv1">
								    <p>1</p>
								  </label>
								</div>
								<div>
								  <input type="radio" id="control_02" name="selectBBC" value="2" class="menuoptBBC">
								  <label for="control_02" class="radioBBC bbv2">
								    <p>2</p>
								  </label>
								</div>
								<div>
								  <input type="radio" id="control_03" name="selectBBC" value="3" class="menuoptBBC">
								  <label for="control_03" class="radioBBC bbv3">
								    <p>3</p>
								  </label>
								</div>
								<div>
								  <input type="radio" id="control_04" name="selectBBC" value="4" class="menuoptBBC">
								  <label for="control_04" class="radioBBC bbv4">
								    <p>4</p>
								  </label>
								</div>
								<div>
								  <input type="radio" id="control_05" name="selectBBC" value="5" class="menuoptBBC">
								  <label for="control_05" class="radioBBC bbv5">
								    <p>5</p>
								  </label>
								</div>
								</section>
						</div>
						<div class="formItems">
	            <h3 class="titlesColorChoosers">Background and Border Color</h3>
							<div class="graphtypes-2">
								<input type="checkbox" id="DefaultR" name="Radiocheck" />
								<label for="DefaultR" class="default dr" >iff  check if you want default colors set.</label>
							</div>
							<section class="radioColorThemeswrap">
								<div>
								  <input type="radio" id="control01" name="selectR" value="1" class="menuopt">
								  <label for="control01" class="radioColor theme1">
										<p class="t1"></p>
										<p class="t2"></p>
										<p class="t3"></p>
										<p class="t4"></p>
										<p class="t5"></p>
								  </label>
								</div>
								<div>
								  <input type="radio" id="control02" name="selectR" value="2" class="menuopt">
								  <label for="control02" class="radioColor theme2">
										<p class="t1"></p>
										<p class="t2"></p>
										<p class="t3"></p>
										<p class="t4"></p>
										<p class="t5"></p>
								  </label>
								</div>
								<div>
								  <input type="radio" id="control03" name="selectR" value="3" class="menuopt">
								  <label for="control03" class="radioColor theme3">
										<p class="t1"></p>
										<p class="t2"></p>
										<p class="t3"></p>
										<p class="t4"></p>
										<p class="t5"></p>
								  </label>
								</div>
								<div>
								  <input type="radio" id="control04" name="selectR" value="4" class="menuopt">
								  <label for="control04" class="radioColor theme4">
										<p class="t1"></p>
										<p class="t2"></p>
										<p class="t3"></p>
										<p class="t4"></p>
										<p class="t5"></p>
								  </label>
								</div>
							</section>
					</div>
					<div class="graphtypes formItems">
							<label for="source">Source</label>
							<input type="text" id="source" name="source" />
					</div>
					<div class="input-div">
						<input type="submit" name='Submit' value="Submit">
					</div>
        </form>
    </div>
  </div>
</div>

{% endif %}

{% for result in results %}
	{{ charts.chart(result[0], src = result[1], vision = result[2], desc = result[3], purp = result[4], title = result[5])}}
{% endfor %}

<script>
$('.inputfile').change(function(e) {
			var $this = $(this);
			$this.next().html($this.val().split('\\').pop());
		});
</script>

<script>
// Get the modal
var modal = document.getElementById('myModal');
var btn = document.getElementById("popupbutton");
var span = document.getElementsByClassName("close")[0];
// When the user clicks the button, open the modal
btn.onclick = function() {
    modal.style.display = "block";
}
// When the user clicks on <span> (x), close the modal
span.onclick = function() {
    modal.style.display = "none";
}
// When the user clicks anywhere outside of the modal, close it
window.onclick = function(event) {
    if (event.target == modal) {
        modal.style.display = "none";
    }
}

</script>

<script>

$('#title').on('input', function() {
	var is_name=$(this).val();
	if(is_name){input.removeClass("invalid").addClass("valid");}
	else{input.removeClass("valid").addClass("invalid");}
});

$('#axis-title-1').on('input', function() {
	var is_name=$(this).val();
	if(is_name){input.removeClass("invalid").addClass("valid");}
	else{input.removeClass("valid").addClass("invalid");}
});

$('#axis-title-2').on('input', function() {
	var is_name=$(this).val();
	if(is_name){input.removeClass("invalid").addClass("valid");}
	else{input.removeClass("valid").addClass("invalid");}
});

$('#description').on('input', function() {
	var is_name=$(this).val();
	if(is_name){input.removeClass("invalid").addClass("valid");}
	else{input.removeClass("valid").addClass("invalid");}
});

</script>

<script>

$(".radioColor").click(function()
	{
		$(this).find('input[type=radio].menuopt').prop("checked", "true");
    })

$(".radioBBC").click(function()
	{
		$(this).find('input[type=radio].menuoptBBC').prop("checked", "true");
		})

$('#DefaultR').change(function () {
     if($('#DefaultR').is(':checked')) {
        $('input[type=radio].menuopt').prop('disabled', 'disabled');
     }
    else{
        $('input[type=radio].menuopt').prop('disabled', false);
    }
});

$('#DefaultBBC').change(function () {
     if($('#DefaultBBC').is(':checked')) {
        $('input[type=radio].menuoptBBC').prop('disabled', 'disabled');
     }
    else{
        $('input[type=radio].menuoptBBC').prop('disabled', false);
    }
});

</script>
<!-- End of each chart section with BACK TO TOP link -->
<div class="scroll-to-top d-lg-none position-fixed ">
      <a class="js-scroll-trigger d-block text-center text-white rounded" href="#top">
        <i class="fa fa-arrow-up"></i> <span class="to-top">back to top</span>
      </a>
</div>

<script>
(function($) {
  "use strict"; // Start of use strict

  // Smooth scrolling using jQuery easing
  $('a.js-scroll-trigger[href*="#"]:not([href="#"])').click(function() {
    if (location.pathname.replace(/^\//, '') == this.pathname.replace(/^\//, '') && location.hostname == this.hostname) {
      var target = $(this.hash);
      target = target.length ? target : $('[name=' + this.hash.slice(1) + ']');
      if (target.length) {
        $('html, body').animate({
          scrollTop: (target.offset().top - 70)
        }, 1000, "easeInOutExpo");
        return false;
      }
    }
  });

  // Scroll to top button appear
  $(document).scroll(function() {
    var scrollDistance = $(this).scrollTop();
    if (scrollDistance > 100) {
      $('.scroll-to-top').fadeIn();
    } else {
      $('.scroll-to-top').fadeOut();
    }
  });

  // Closes responsive menu when a scroll trigger link is clicked
  $('.js-scroll-trigger').click(function() {
    $('.navbar-collapse').collapse('hide');
  });
</script>
